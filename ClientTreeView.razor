@using Microsoft.AspNetCore.Components.Authorization
@using MXAdmin.Frontend.Client.Contracts.MXAdminApp.Services.Clients

<PageTitle>Client List</PageTitle>
<AuthorizeView>
    <Authorized>
        <MudPaper Class="pa-4 mb-4" Elevation="0" Width="300px">
            <MudText Typo="Typo.h5" Class="font-weight-bold mb-2">
                Clients
            </MudText>
            <MudText Typo="Typo.body2" Class="mb-4">
                Browse and select a client from the tree view below.
            </MudText>

            @if (Model is null)
            {
                <MudStack AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center" Style="min-height: 150px;">
                    <MudProgressCircular Indeterminate />
                    <MudText Class="mt-2">Loading clients...</MudText>
                </MudStack>
            }
            else if (!Model.Any())
            {
                <MudText Color="Color.Secondary">
                    No clients found.
                </MudText>
            }
            else
            {
                <MudTreeView Hover T="ClientTreeItem" ReadOnly Color="Color.Tertiary">

                    <MudTreeViewItem Text="Clients" Expanded="true">

                        @foreach (var client in Model)
                        {
                            <div @onclick="@(OpenContextMenu)" @oncontextmenu="@(OpenContextMenu)" @oncontextmenu:preventDefault @oncontextmenu:stopPropagation>
                                <MudTreeViewItem T="ClientTreeItem" Value="@CreateClientItem(client)" OnClick="@((e) => OnClientClick(client))" Text="@client.ClientName" Icon="@Icons.Material.Filled.Business" Expanded="false">
                                @* <MudTreeViewItem T="ClientTreeItem" Value="@CreateClientItem(client)" OnClick="@((e)=> OnClientClick(e))" OnClick="@(() => OnClientClick(client))" Text="@client.ClientName" Icon="@Icons.Material.Filled.Business" Expanded="false"> *@
                                    @if (client.Sites?.Any() == true)
                                    {
                                        @foreach (var site in client.Sites)
                                        {
                                            <div @onclick="@(OpenSiteContextMenu)" @oncontextmenu="@(OpenSiteContextMenu)" @oncontextmenu:preventDefault @oncontextmenu:stopPropagation>
                                                <MudTreeViewItem T="ClientTreeItem" Value="@CreateSiteItem(site)" OnClick="@(() => OnSiteClick(client, site.SiteId))" Text="@site.SiteName" Icon="@Icons.Material.Filled.LocationOn" Expanded="false">

                                                    @if (site.Divisions?.Any() == true)
                                                    {
                                                        @foreach (var division in site.Divisions)
                                                        {
                                                            <MudTreeViewItem T="ClientTreeItem" Value="@CreateDivisionItem(division)" OnClick="@(() => OnDivisionClick(client, site.SiteId, division.DivisionId))" Text="@division.DivisionName" Icon="@Icons.Material.Filled.AccountTree">

                                                            </MudTreeViewItem>
                                                        }
                                                    }

                                                </MudTreeViewItem>
                                            </div>
                                        }
                                    }
                                </MudTreeViewItem>
                            </div>
                        }
                    </MudTreeViewItem>
                </MudTreeView>
            }
        </MudPaper>

        <MudMenu PositionAtCursor @ref="_contextMenu">
            <MudMenuItem Icon="@Icons.Material.Filled.Add" Label="Add Site" />
            <MudMenuItem Icon="@Icons.Material.Filled.Delete" Label="Delete Client" />
        </MudMenu>

        <MudMenu PositionAtCursor @ref="_siteContextMenu">
            <MudMenuItem Icon="@Icons.Material.Filled.Add" Label="Add Division" />
            <MudMenuItem Icon="@Icons.Material.Filled.Delete" Label="Delete Site" />
        </MudMenu>
    </Authorized>
    <NotAuthorized>
        <p>You are not authenticated.</p>
    </NotAuthorized>
</AuthorizeView>